machine:
  python:
    version: 3.6.0
  services:
    - redis
  environment:
    CASS_DRIVER_NO_CYTHON: 1
    CASS_DRIVER_NO_EXTENSIONS: 1
    LANG: C.UTF-8

dependencies:
  pre:
    - pip install tox
    - pip install -r requirements/test.txt
    - sudo -u postgres createuser lego -s
  override:
    - tox --notest

test:
  pre:
    - make ci_settings
  override:
    - tox -e tests
    - tox -e isort
    - tox -e flake8
    - tox -e coverage
    - tox -e docs

    - sudo -u postgres createdb lego
    - python manage.py migrate
    - python manage.py missing_migrations
